{"ast":null,"code":"import _regeneratorRuntime from\"/home/brian/Desktop/non-functional-wa-connection-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/brian/Desktop/non-functional-wa-connection-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/brian/Desktop/non-functional-wa-connection-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from\"react\";import TextEditor from\"./../components/TextEditor/TextEditor\";import AddTextEditor from\"./../components/AddTextEditor/AddTextEditor\";import{CreateVariant,DeleteVariant,EditVariant,DeleteAll,SetActiveVariant}from\"./../store/actions/TextNessageVariantAction\";import{changeNav as _changeNav}from\"./../store/actions/SideNavActions\";import{Loading,Table,TableRow,TableHead,TableHeader,TableCell,Button,Modal,TableBody,InlineLoading,ExpandableTile,TileAboveTheFoldContent}from\"carbon-components-react\";import{useHistory}from\"react-router-dom\";import{connect}from\"react-redux\";import{Send16}from\"@carbon/icons-react\";import SelectConnection from\"./../components/SelectConnection/SelectConnection\";function SendTextMessage(props){useEffect(function(){props.deleteAll();},[]);var history=useHistory();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),selectedConnection=_useState2[0],setSelectedConnection=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),selectedContact=_useState4[0],setSelectedContact=_useState4[1];var _useState5=useState(\"10\"),_useState6=_slicedToArray(_useState5,2),selectedCooldown=_useState6[0],setSelectedCooldown=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),contactsInterval=_useState8[0],setContactsInterval=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),sendStatus=_useState12[0],setSendStaus=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),dispatchStatus=_useState14[0],setDispatchStatus=_useState14[1];var _useState15=useState({variables:[\"Contact list is not selected\"]}),_useState16=_slicedToArray(_useState15,2),contact=_useState16[0],setContact=_useState16[1];var calcContactsInterval=function calcContactsInterval(){var messageAmount=Math.floor(290/(2+parseInt(selectedCooldown)));console.log(\"Message amount: \",messageAmount);console.log(\"Contact length: \",contact.length);var messageQuant=messageAmount>contact.length?1:Math.floor(contact.length/messageAmount);var messageReminder=messageAmount>contact.length?0:Math.floor(contact.length%messageAmount);var count=0;var tmpInterval=[];var lastSuperior=0;for(var i=0;i<messageQuant;i++){if(messageAmount>contact.length){tmpInterval.push([0,contact.length]);}else{tmpInterval.push([i*messageAmount,(i+1)*messageAmount]);}lastSuperior=(i+1)*messageAmount;}if(messageReminder!==0){tmpInterval.push([lastSuperior,lastSuperior+messageReminder]);}setContactsInterval(tmpInterval);console.log(\"tmpInterval: \",tmpInterval);};useEffect(function(){calcContactsInterval();},[contact,selectedCooldown,selectedConnection]);var handleSelectConnection=function handleSelectConnection(e){setSelectedConnection(e.target.value);};var handleSelectCooldown=function handleSelectCooldown(e){setSelectedCooldown(e.target.value);};var toggleDispatch=function toggleDispatch(){setDispatchStatus(!dispatchStatus);};var handleModalClose=function handleModalClose(){props.changeNav(\"dashboard\");history.push(\"/app/dashboard\");};var handleSelectContact=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var tmpContact;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:tmpContact=props.contacts.find(function(elm){return elm.id===e.target.value;});console.log(\"Contact!\",tmpContact);setContact(tmpContact);setSelectedContact(e.target.value);case 4:case\"end\":return _context.stop();}}},_callee);}));return function handleSelectContact(_x){return _ref.apply(this,arguments);};}();var sendMessages=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var tmpVariants;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);tmpVariants=props.textMessageVariants.variants.map(function(elm){return elm.body;});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function sendMessages(){return _ref2.apply(this,arguments);};}();if(dispatchStatus){return/*#__PURE__*/_jsx(Modal,{open:dispatchStatus,passiveModal:true,onRequestClose:handleModalClose,modalHeading:\"Dispatch status\",hasForm:true,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableHeader,{}),/*#__PURE__*/_jsx(TableHeader,{children:\"Phone \"}),/*#__PURE__*/_jsx(TableHeader,{children:\"Message \"})]})}),/*#__PURE__*/_jsx(TableBody,{children:sendStatus.map(function(elm,i){return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsxs(TableCell,{children:[i,\" \"]}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(InlineLoading,{status:elm.sendStatus,description:elm.receiverNumber})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(ExpandableTile,{children:[/*#__PURE__*/_jsx(\"p\",{}),/*#__PURE__*/_jsx(TileAboveTheFoldContent,{children:/*#__PURE__*/_jsx(\"p\",{children:elm.message})})]})})]},i);})})]})});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"send-text-message\",children:[loading?/*#__PURE__*/_jsx(Loading,{}):null,/*#__PURE__*/_jsx(SelectConnection,{handleSelectContact:handleSelectContact,handleSelectConnection:handleSelectConnection,handleSelectCooldown:handleSelectCooldown,cooldown:selectedCooldown}),props.textMessageVariants.variants.map(function(elm,i){return/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return props.setActiveVariant(i);},children:/*#__PURE__*/_jsx(TextEditor,{editVariant:props.editVariant,variables:contact.variables,editorIndex:i,textState:elm.textState,open:elm.active},i)});}),/*#__PURE__*/_jsx(AddTextEditor,{messageType:\"text\"}),props.textMessageVariants.variants.length>0?/*#__PURE__*/_jsx(Button,{kind:\"primary\",style:{marginTop:\"64px\"},renderIcon:Send16,onClick:sendMessages,children:\"Send Messages\"}):null]});}}var stateToProps=function stateToProps(state){return{textMessageVariants:state.textMessageVariants,contacts:state.firestore.ordered.contacts,connections:state.firestore.ordered.connections,uid:state.firebase.auth.uid,token:state.firebase.profile.token.token};};var dispatchToProps=function dispatchToProps(dispatch){return{changeNav:function changeNav(elm){return dispatch(_changeNav(elm));},createVariant:function createVariant(elm){return dispatch(CreateVariant(elm));},deleteVariant:function deleteVariant(id){return dispatch(DeleteVariant(id));},editVariant:function editVariant(index,text){return dispatch(EditVariant(index,text));},deleteAll:function deleteAll(){return dispatch(DeleteAll());},setActiveVariant:function setActiveVariant(id){return dispatch(SetActiveVariant(id));}};};export default connect(stateToProps,dispatchToProps)(SendTextMessage);","map":{"version":3,"sources":["/home/brian/Desktop/non-functional-wa-connection-demo/src/pages/SendTextMessage.js"],"names":["React","useState","useEffect","TextEditor","AddTextEditor","CreateVariant","DeleteVariant","EditVariant","DeleteAll","SetActiveVariant","changeNav","Loading","Table","TableRow","TableHead","TableHeader","TableCell","Button","Modal","TableBody","InlineLoading","ExpandableTile","TileAboveTheFoldContent","useHistory","connect","Send16","SelectConnection","SendTextMessage","props","deleteAll","history","selectedConnection","setSelectedConnection","selectedContact","setSelectedContact","selectedCooldown","setSelectedCooldown","contactsInterval","setContactsInterval","loading","setLoading","sendStatus","setSendStaus","dispatchStatus","setDispatchStatus","variables","contact","setContact","calcContactsInterval","messageAmount","Math","floor","parseInt","console","log","length","messageQuant","messageReminder","count","tmpInterval","lastSuperior","i","push","handleSelectConnection","e","target","value","handleSelectCooldown","toggleDispatch","handleModalClose","handleSelectContact","tmpContact","contacts","find","elm","id","sendMessages","tmpVariants","textMessageVariants","variants","map","body","receiverNumber","message","setActiveVariant","editVariant","textState","active","marginTop","stateToProps","state","firestore","ordered","connections","uid","firebase","auth","token","profile","dispatchToProps","dispatch","createVariant","deleteVariant","index","text"],"mappings":"ylBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,UAAP,KAAuB,uCAAvB,CACA,MAAOC,CAAAA,aAAP,KAA0B,6CAA1B,CACA,OACEC,aADF,CAEEC,aAFF,CAGEC,WAHF,CAIEC,SAJF,CAKEC,gBALF,KAMO,6CANP,CAOA,OAASC,SAAS,GAATA,CAAAA,UAAT,KAA0B,mCAA1B,CACA,OACEC,OADF,CAEEC,KAFF,CAGEC,QAHF,CAIEC,SAJF,CAKEC,WALF,CAMEC,SANF,CAOEC,MAPF,CAQEC,KARF,CASEC,SATF,CAUEC,aAVF,CAWEC,cAXF,CAYEC,uBAZF,KAaO,yBAbP,CAeA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,OAAT,KAAwB,aAAxB,CACA,OAASC,MAAT,KAAuB,qBAAvB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,mDAA7B,CAEA,QAASC,CAAAA,eAAT,CAAyBC,KAAzB,CAAgC,CAC9B1B,SAAS,CAAC,UAAM,CACd0B,KAAK,CAACC,SAAN,GACD,CAFQ,CAEN,EAFM,CAAT,CAIA,GAAMC,CAAAA,OAAO,CAAGP,UAAU,EAA1B,CAL8B,cAOsBtB,QAAQ,CAAC,EAAD,CAP9B,wCAOvB8B,kBAPuB,eAOHC,qBAPG,8BAQgB/B,QAAQ,CAAC,EAAD,CARxB,yCAQvBgC,eARuB,eAQNC,kBARM,8BASkBjC,QAAQ,CAAC,IAAD,CAT1B,yCASvBkC,gBATuB,eASLC,mBATK,8BAUkBnC,QAAQ,CAAC,EAAD,CAV1B,yCAUvBoC,gBAVuB,eAULC,mBAVK,8BAWArC,QAAQ,CAAC,KAAD,CAXR,0CAWvBsC,OAXuB,gBAWdC,UAXc,gCAYKvC,QAAQ,CAAC,EAAD,CAZb,2CAYvBwC,UAZuB,gBAYXC,YAZW,gCAaczC,QAAQ,CAAC,KAAD,CAbtB,2CAavB0C,cAbuB,gBAaPC,iBAbO,gCAeA3C,QAAQ,CAAC,CACrC4C,SAAS,CAAE,CAAC,8BAAD,CAD0B,CAAD,CAfR,2CAevBC,OAfuB,gBAedC,UAfc,gBAmB9B,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,EAAM,CACjC,GAAMC,CAAAA,aAAa,CAAGC,IAAI,CAACC,KAAL,CAAW,KAAO,EAAIC,QAAQ,CAACjB,gBAAD,CAAnB,CAAX,CAAtB,CACAkB,OAAO,CAACC,GAAR,CAAY,kBAAZ,CAAgCL,aAAhC,EACAI,OAAO,CAACC,GAAR,CAAY,kBAAZ,CAAgCR,OAAO,CAACS,MAAxC,EAEA,GAAMC,CAAAA,YAAY,CAChBP,aAAa,CAAGH,OAAO,CAACS,MAAxB,CACI,CADJ,CAEIL,IAAI,CAACC,KAAL,CAAWL,OAAO,CAACS,MAAR,CAAiBN,aAA5B,CAHN,CAIA,GAAMQ,CAAAA,eAAe,CACnBR,aAAa,CAAGH,OAAO,CAACS,MAAxB,CACI,CADJ,CAEIL,IAAI,CAACC,KAAL,CAAWL,OAAO,CAACS,MAAR,CAAiBN,aAA5B,CAHN,CAIA,GAAMS,CAAAA,KAAK,CAAG,CAAd,CACA,GAAIC,CAAAA,WAAW,CAAG,EAAlB,CACA,GAAIC,CAAAA,YAAY,CAAG,CAAnB,CAEA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGL,YAApB,CAAkCK,CAAC,EAAnC,CAAuC,CACrC,GAAIZ,aAAa,CAAGH,OAAO,CAACS,MAA5B,CAAoC,CAClCI,WAAW,CAACG,IAAZ,CAAiB,CAAC,CAAD,CAAIhB,OAAO,CAACS,MAAZ,CAAjB,EACD,CAFD,IAEO,CACLI,WAAW,CAACG,IAAZ,CAAiB,CAACD,CAAC,CAAGZ,aAAL,CAAoB,CAACY,CAAC,CAAG,CAAL,EAAUZ,aAA9B,CAAjB,EACD,CACDW,YAAY,CAAG,CAACC,CAAC,CAAG,CAAL,EAAUZ,aAAzB,CACD,CACD,GAAIQ,eAAe,GAAK,CAAxB,CAA2B,CACzBE,WAAW,CAACG,IAAZ,CAAiB,CAACF,YAAD,CAAeA,YAAY,CAAGH,eAA9B,CAAjB,EACD,CACDnB,mBAAmB,CAACqB,WAAD,CAAnB,CACAN,OAAO,CAACC,GAAR,CAAY,eAAZ,CAA6BK,WAA7B,EACD,CA9BD,CAgCAzD,SAAS,CAAC,UAAM,CACd8C,oBAAoB,GACrB,CAFQ,CAEN,CAACF,OAAD,CAAUX,gBAAV,CAA4BJ,kBAA5B,CAFM,CAAT,CAIA,GAAMgC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,CAAD,CAAO,CACpChC,qBAAqB,CAACgC,CAAC,CAACC,MAAF,CAASC,KAAV,CAArB,CACD,CAFD,CAIA,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACH,CAAD,CAAO,CAClC5B,mBAAmB,CAAC4B,CAAC,CAACC,MAAF,CAASC,KAAV,CAAnB,CACD,CAFD,CAIA,GAAME,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,CAC3BxB,iBAAiB,CAAC,CAACD,cAAF,CAAjB,CACD,CAFD,CAIA,GAAM0B,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,CAC7BzC,KAAK,CAAClB,SAAN,CAAgB,WAAhB,EACAoB,OAAO,CAACgC,IAAR,CAAa,gBAAb,EACD,CAHD,CAKA,GAAMQ,CAAAA,mBAAmB,0FAAG,iBAAON,CAAP,iIACpBO,UADoB,CACP3C,KAAK,CAAC4C,QAAN,CAAeC,IAAf,CAAoB,SAACC,GAAD,CAAS,CAC9C,MAAOA,CAAAA,GAAG,CAACC,EAAJ,GAAWX,CAAC,CAACC,MAAF,CAASC,KAA3B,CACD,CAFkB,CADO,CAK1Bb,OAAO,CAACC,GAAR,CAAY,UAAZ,CAAwBiB,UAAxB,EAEAxB,UAAU,CAACwB,UAAD,CAAV,CACArC,kBAAkB,CAAC8B,CAAC,CAACC,MAAF,CAASC,KAAV,CAAlB,CAR0B,sDAAH,kBAAnBI,CAAAA,mBAAmB,4CAAzB,CAWA,GAAMM,CAAAA,YAAY,2FAAG,wJACnBpC,UAAU,CAAC,IAAD,CAAV,CAEMqC,WAHa,CAGCjD,KAAK,CAACkD,mBAAN,CAA0BC,QAA1B,CAAmCC,GAAnC,CAAuC,SAACN,GAAD,CAAS,CAClE,MAAOA,CAAAA,GAAG,CAACO,IAAX,CACD,CAFmB,CAHD,yDAAH,kBAAZL,CAAAA,YAAY,2CAAlB,CAQA,GAAIjC,cAAJ,CAAoB,CAClB,mBACE,KAAC,KAAD,EACE,IAAI,CAAEA,cADR,CAEE,YAAY,KAFd,CAGE,cAAc,CAAE0B,gBAHlB,CAIE,YAAY,CAAC,iBAJf,CAKE,OAAO,KALT,uBAOE,MAAC,KAAD,yBACE,KAAC,SAAD,wBACE,MAAC,QAAD,yBACE,KAAC,WAAD,IADF,cAEE,KAAC,WAAD,qBAFF,cAGE,KAAC,WAAD,uBAHF,GADF,EADF,cAQE,KAAC,SAAD,WACG5B,UAAU,CAACuC,GAAX,CAAe,SAACN,GAAD,CAAMb,CAAN,CAAY,CAC1B,mBACE,MAAC,QAAD,yBACE,MAAC,SAAD,YAAYA,CAAZ,OADF,cAEE,KAAC,SAAD,wBACE,KAAC,aAAD,EACE,MAAM,CAAEa,GAAG,CAACjC,UADd,CAEE,WAAW,CAAEiC,GAAG,CAACQ,cAFnB,EADF,EAFF,cAQE,KAAC,SAAD,wBACE,MAAC,cAAD,yBACE,YADF,cAEE,KAAC,uBAAD,wBACE,mBAAIR,GAAG,CAACS,OAAR,EADF,EAFF,GADF,EARF,GAAetB,CAAf,CADF,CAmBD,CApBA,CADH,EARF,GAPF,EADF,CA0CD,CA3CD,IA2CO,CACL,mBACE,aAAK,SAAS,CAAC,mBAAf,WACGtB,OAAO,cAAG,KAAC,OAAD,IAAH,CAAiB,IAD3B,cAEE,KAAC,gBAAD,EACE,mBAAmB,CAAE+B,mBADvB,CAEE,sBAAsB,CAAEP,sBAF1B,CAGE,oBAAoB,CAAEI,oBAHxB,CAIE,QAAQ,CAAEhC,gBAJZ,EAFF,CASGP,KAAK,CAACkD,mBAAN,CAA0BC,QAA1B,CAAmCC,GAAnC,CAAuC,SAACN,GAAD,CAAMb,CAAN,CAAY,CAClD,mBACE,YAAK,OAAO,CAAE,yBAAMjC,CAAAA,KAAK,CAACwD,gBAAN,CAAuBvB,CAAvB,CAAN,EAAd,uBACE,KAAC,UAAD,EAEE,WAAW,CAAEjC,KAAK,CAACyD,WAFrB,CAGE,SAAS,CAAEvC,OAAO,CAACD,SAHrB,CAIE,WAAW,CAAEgB,CAJf,CAKE,SAAS,CAAEa,GAAG,CAACY,SALjB,CAME,IAAI,CAAEZ,GAAG,CAACa,MANZ,EACO1B,CADP,CADF,EADF,CAYD,CAbA,CATH,cAwBE,KAAC,aAAD,EAAe,WAAW,CAAC,MAA3B,EAxBF,CA0BGjC,KAAK,CAACkD,mBAAN,CAA0BC,QAA1B,CAAmCxB,MAAnC,CAA4C,CAA5C,cACC,KAAC,MAAD,EACE,IAAI,CAAC,SADP,CAEE,KAAK,CAAE,CAAEiC,SAAS,CAAE,MAAb,CAFT,CAGE,UAAU,CAAE/D,MAHd,CAIE,OAAO,CAAEmD,YAJX,2BADD,CASG,IAnCN,GADF,CAuCD,CACF,CAED,GAAMa,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,KAAD,CAAW,CAC9B,MAAO,CACLZ,mBAAmB,CAAEY,KAAK,CAACZ,mBADtB,CAELN,QAAQ,CAAEkB,KAAK,CAACC,SAAN,CAAgBC,OAAhB,CAAwBpB,QAF7B,CAGLqB,WAAW,CAAEH,KAAK,CAACC,SAAN,CAAgBC,OAAhB,CAAwBC,WAHhC,CAILC,GAAG,CAAEJ,KAAK,CAACK,QAAN,CAAeC,IAAf,CAAoBF,GAJpB,CAKLG,KAAK,CAAEP,KAAK,CAACK,QAAN,CAAeG,OAAf,CAAuBD,KAAvB,CAA6BA,KAL/B,CAAP,CAOD,CARD,CAUA,GAAME,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,QAAD,CAAc,CACpC,MAAO,CACL1F,SAAS,CAAE,mBAACgE,GAAD,QAAS0B,CAAAA,QAAQ,CAAC1F,UAAS,CAACgE,GAAD,CAAV,CAAjB,EADN,CAEL2B,aAAa,CAAE,uBAAC3B,GAAD,QAAS0B,CAAAA,QAAQ,CAAC/F,aAAa,CAACqE,GAAD,CAAd,CAAjB,EAFV,CAGL4B,aAAa,CAAE,uBAAC3B,EAAD,QAAQyB,CAAAA,QAAQ,CAAC9F,aAAa,CAACqE,EAAD,CAAd,CAAhB,EAHV,CAILU,WAAW,CAAE,qBAACkB,KAAD,CAAQC,IAAR,QAAiBJ,CAAAA,QAAQ,CAAC7F,WAAW,CAACgG,KAAD,CAAQC,IAAR,CAAZ,CAAzB,EAJR,CAKL3E,SAAS,CAAE,2BAAMuE,CAAAA,QAAQ,CAAC5F,SAAS,EAAV,CAAd,EALN,CAML4E,gBAAgB,CAAE,0BAACT,EAAD,QAAQyB,CAAAA,QAAQ,CAAC3F,gBAAgB,CAACkE,EAAD,CAAjB,CAAhB,EANb,CAAP,CAQD,CATD,CAWA,cAAenD,CAAAA,OAAO,CAACiE,YAAD,CAAeU,eAAf,CAAP,CAAuCxE,eAAvC,CAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport TextEditor from \"./../components/TextEditor/TextEditor\";\nimport AddTextEditor from \"./../components/AddTextEditor/AddTextEditor\";\nimport {\n  CreateVariant,\n  DeleteVariant,\n  EditVariant,\n  DeleteAll,\n  SetActiveVariant,\n} from \"./../store/actions/TextNessageVariantAction\";\nimport { changeNav } from \"./../store/actions/SideNavActions\";\nimport {\n  Loading,\n  Table,\n  TableRow,\n  TableHead,\n  TableHeader,\n  TableCell,\n  Button,\n  Modal,\n  TableBody,\n  InlineLoading,\n  ExpandableTile,\n  TileAboveTheFoldContent,\n} from \"carbon-components-react\";\n\nimport { useHistory } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { Send16 } from \"@carbon/icons-react\";\nimport SelectConnection from \"./../components/SelectConnection/SelectConnection\";\n\nfunction SendTextMessage(props) {\n  useEffect(() => {\n    props.deleteAll();\n  }, []);\n\n  const history = useHistory();\n\n  const [selectedConnection, setSelectedConnection] = useState(\"\");\n  const [selectedContact, setSelectedContact] = useState(\"\");\n  const [selectedCooldown, setSelectedCooldown] = useState(\"10\");\n  const [contactsInterval, setContactsInterval] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [sendStatus, setSendStaus] = useState([]);\n  const [dispatchStatus, setDispatchStatus] = useState(false);\n\n  const [contact, setContact] = useState({\n    variables: [\"Contact list is not selected\"],\n  });\n\n  const calcContactsInterval = () => {\n    const messageAmount = Math.floor(290 / (2 + parseInt(selectedCooldown)));\n    console.log(\"Message amount: \", messageAmount);\n    console.log(\"Contact length: \", contact.length);\n\n    const messageQuant =\n      messageAmount > contact.length\n        ? 1\n        : Math.floor(contact.length / messageAmount);\n    const messageReminder =\n      messageAmount > contact.length\n        ? 0\n        : Math.floor(contact.length % messageAmount);\n    const count = 0;\n    let tmpInterval = [];\n    let lastSuperior = 0;\n\n    for (let i = 0; i < messageQuant; i++) {\n      if (messageAmount > contact.length) {\n        tmpInterval.push([0, contact.length]);\n      } else {\n        tmpInterval.push([i * messageAmount, (i + 1) * messageAmount]);\n      }\n      lastSuperior = (i + 1) * messageAmount;\n    }\n    if (messageReminder !== 0) {\n      tmpInterval.push([lastSuperior, lastSuperior + messageReminder]);\n    }\n    setContactsInterval(tmpInterval);\n    console.log(\"tmpInterval: \", tmpInterval);\n  };\n\n  useEffect(() => {\n    calcContactsInterval();\n  }, [contact, selectedCooldown, selectedConnection]);\n\n  const handleSelectConnection = (e) => {\n    setSelectedConnection(e.target.value);\n  };\n\n  const handleSelectCooldown = (e) => {\n    setSelectedCooldown(e.target.value);\n  };\n\n  const toggleDispatch = () => {\n    setDispatchStatus(!dispatchStatus);\n  };\n\n  const handleModalClose = () => {\n    props.changeNav(\"dashboard\");\n    history.push(\"/app/dashboard\");\n  };\n\n  const handleSelectContact = async (e) => {\n    const tmpContact = props.contacts.find((elm) => {\n      return elm.id === e.target.value;\n    });\n\n    console.log(\"Contact!\", tmpContact);\n\n    setContact(tmpContact);\n    setSelectedContact(e.target.value);\n  };\n\n  const sendMessages = async () => {\n    setLoading(true);\n\n    const tmpVariants = props.textMessageVariants.variants.map((elm) => {\n      return elm.body;\n    });\n  };\n\n  if (dispatchStatus) {\n    return (\n      <Modal\n        open={dispatchStatus}\n        passiveModal\n        onRequestClose={handleModalClose}\n        modalHeading=\"Dispatch status\"\n        hasForm\n      >\n        <Table>\n          <TableHead>\n            <TableRow>\n              <TableHeader />\n              <TableHeader>Phone </TableHeader>\n              <TableHeader>Message </TableHeader>\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {sendStatus.map((elm, i) => {\n              return (\n                <TableRow key={i}>\n                  <TableCell>{i} </TableCell>\n                  <TableCell>\n                    <InlineLoading\n                      status={elm.sendStatus}\n                      description={elm.receiverNumber}\n                    />\n                  </TableCell>\n                  <TableCell>\n                    <ExpandableTile>\n                      <p></p>\n                      <TileAboveTheFoldContent>\n                        <p>{elm.message}</p>\n                      </TileAboveTheFoldContent>\n                    </ExpandableTile>\n                  </TableCell>\n                </TableRow>\n              );\n            })}\n          </TableBody>\n        </Table>\n      </Modal>\n    );\n  } else {\n    return (\n      <div className=\"send-text-message\">\n        {loading ? <Loading /> : null}\n        <SelectConnection\n          handleSelectContact={handleSelectContact}\n          handleSelectConnection={handleSelectConnection}\n          handleSelectCooldown={handleSelectCooldown}\n          cooldown={selectedCooldown}\n        />\n\n        {props.textMessageVariants.variants.map((elm, i) => {\n          return (\n            <div onClick={() => props.setActiveVariant(i)}>\n              <TextEditor\n                key={i}\n                editVariant={props.editVariant}\n                variables={contact.variables}\n                editorIndex={i}\n                textState={elm.textState}\n                open={elm.active}\n              />\n            </div>\n          );\n        })}\n\n        <AddTextEditor messageType=\"text\" />\n\n        {props.textMessageVariants.variants.length > 0 ? (\n          <Button\n            kind=\"primary\"\n            style={{ marginTop: \"64px\" }}\n            renderIcon={Send16}\n            onClick={sendMessages}\n          >\n            Send Messages\n          </Button>\n        ) : null}\n      </div>\n    );\n  }\n}\n\nconst stateToProps = (state) => {\n  return {\n    textMessageVariants: state.textMessageVariants,\n    contacts: state.firestore.ordered.contacts,\n    connections: state.firestore.ordered.connections,\n    uid: state.firebase.auth.uid,\n    token: state.firebase.profile.token.token,\n  };\n};\n\nconst dispatchToProps = (dispatch) => {\n  return {\n    changeNav: (elm) => dispatch(changeNav(elm)),\n    createVariant: (elm) => dispatch(CreateVariant(elm)),\n    deleteVariant: (id) => dispatch(DeleteVariant(id)),\n    editVariant: (index, text) => dispatch(EditVariant(index, text)),\n    deleteAll: () => dispatch(DeleteAll()),\n    setActiveVariant: (id) => dispatch(SetActiveVariant(id)),\n  };\n};\n\nexport default connect(stateToProps, dispatchToProps)(SendTextMessage);\n"]},"metadata":{},"sourceType":"module"}